# CH32X035の役割
CH32X035は、FDDアダプタの制御とUSB PD通信を担当します。

## FDDの制御
MinyasXの基板は、X68000のFDDコネクタとPC用FDDコネクタの間に接続されます。
基本的にすべての信号の間にバッファを入れており、両者の信号は完全に切り離して
独立にアクセスすることが可能です。
PC用のFDDは、たとえばMOTOR ONをアサートしてINDEX信号を見ることでメディアの状態を確認したり、
DRIVE SELECT信号をアサートして DISK CHANGE信号を監視することで、メディアの入れ替えを検出したり
できます。
MinyasXはこれらの信号をX68000側と独立して制御することができるので、
X68000のDISK IN割り込みなどをサポとすることができます。

## USB PD通信
CH32X035はUSB PD(Power Delivery)通信を行い、PC用FDDに必要な+5V、+12V電源を供給します。
USB PD通信は、CH32X035のUSB Type-Cコネクタに接続されたUSB PD対応ACアダプタと行います。

### 起動直後
起動直後はUSBのVBUSは+5Vに設定されています。マイコンの電源(VDD_MCU)はVBUSに接続した +5Vの
レギュレータで生成しています。レギュレータの入力が+5Vしかないので、このタイミングでのVDD_MCUは
+4V程度になっていますが、 CH32X035は+3.3Vで動作するので問題ありません。

### USB PD通信による+12V供給要求
通信の結果、アダプタが+12V(1.6A以上)の電源が供給できる場合は、VBUSを+12Vに設定します。
VDD_MCUは+5Vに上昇します。
もし+12Vが供給できない場合は、+5Vのままになります。

### +12V動作の詳細
+12Vに昇圧できた場合は、+12V_ENABLE信号をアサートして、FETスイッチをONにします。
すると、FDDの+12Vや基板上のDCDCコンバータに+12Vが供給されます。
FDD用の+5Vは消費電力が多いので、レギュレータ経由ではなく、DCDCコンバータで生成します。

### +5V動作の詳細
+5Vしか利用できない場合は、+5V_ENABLE信号をアサートして、FETスイッチをONにします。
すると、FDDの+5Vに+5Vが供給されます。

### VDD_MCUの電圧変動
VDD_MCUは以下の3つの電源がダイオードで接続されています。
* 初期動作用の+5Vレギュレータ出力
* USB PD通信で+5Vに設定されたVBUS
* USB PD通信で+12Vに設定されたVBUSからDCDCコンバータで生成された+5V
そのため、USB PD通信でVBUSが+5Vから+12Vに変化したときに、VDD_MCUの電圧が +5Vに上昇します。


## OLEDディスプレイ + ジョイスティック
